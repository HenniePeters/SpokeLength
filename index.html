<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <title>Tommeritis magnificus</title>
    <style>
    html { font-family: 'Dejavu Sans', Verdana; background-color:#FFFFFF; }
    .inputfield  { font-size:18px; color:black; background-color:white;   border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .inputfield2 { font-size:18px; color:black; background-color:white;   border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .inputfield3 { font-size:18px; color:black; background-color:white;   border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .inputfield4 { font-size:18px; color:black; background-color:white;   border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .inputfield5 { font-size:18px; color:black; background-color:white;   border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .inputfield6 { font-size:18px; color:black; background-color:white;   border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .output      { font-size:18px; color:black; background-color:#D8D8D8; border-style:solid; border-color: #A0A0A0; border-width: 1px; }
    .small       { font-size:8px; }
    input[type="tel"] {
        border-style: solid;
        border-width: 1px;
        border-color: #A0A0A0;
        border-radius: 5px;
    }    </style>
  </head>
  <body onload="onload();onload();" style="vertical-align:top; margin-top:0; background-color:#FFFFFF;">
    <table id="start" style="background-color:#FFFFFF;"><tr><td style="padding-top:0;">
      <table id="table" style="color:#404040;">
        <tr>
          <td colspan="2" style="padding-top:0; font-size:28px;"><b>Spoke&nbsp;length&nbsp;calculator&nbsp;</b></td>
        </tr><tr>
          <td colspan="2" style="font-size:22px;"><b>Insert values:</b></td>
        </tr><tr>
          <td colspan="2" >Provide all values to start the calculation</td>
        </tr><tr class="small" >
          <td>&nbsp;</td>
        </tr><tr>
          <td><label class="label" for="total-length-hub">Total hub length:</label></td>
          <td><input onchange="validate()" onfocus="SizeTotalHub(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="total-length-hub" type="tel" value='130' />&nbsp;mm</td>
        </tr><tr>
          <td><label class="label" for="gear-side">Gear side:</label></td>
          <td><input onchange="validate()" onfocus="SizeGear(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="gear-side" type="tel" value='41.55' />&nbsp;mm</td>
        </tr><tr>
          <td><label class="label" for="non-gear-side">Non-gear side:</label></td>
          <td><input onchange="validate()" onfocus="SizeNonGear(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="non-gear-side" type="tel" value='33.85' />&nbsp;mm</td>
        </tr><tr class="small" >
          <td>&nbsp;</td>
        </tr><tr>
          <td><label class="label" for="hub-diameter-gear">Hub diameter gear side:</label></td>
          <td><input onchange="validate()" onfocus="DiamGear(this)" onfocusout="FocusOut(this)"class="inputfield" size="5" id="hub-diameter-gear" type="tel" value='87' />&nbsp;mm</td>
        </tr><tr>
          <td><label class="label" for="hub-diameter-non-gear">Hub diameter non-gear side:</label></td>
          <td><input onchange="validate()" onfocus="DiamNonGear(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="hub-diameter-non-gear" type="tel" value='87' />&nbsp;mm</td>
        </tr><tr class="small" >
          <td>&nbsp;</td>
        </tr><tr>
          <td><label class="label" for="internal-diameter">Internal rim diameter:</label></td>
          <td><input onchange="validate()" onfocus="IntRimDiam(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="internal-diameter" type="tel" value='584' />&nbsp;mm</td>
        </tr><tr>
          <td><label class="label" for="rim-thickness">Rim thickness:</label></td>
          <td><input onchange="validate()" onfocus="RimThick(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="rim-thickness" type="tel" value='2' />&nbsp;mm</td>
        </tr><tr class="small" >
          <td>&nbsp;</td>
        </tr><tr>
          <td><label class="label" for="number-of-spokes">Number of spokes:</label></td>
          <td><input onchange="validate()" onkeyup="TotalSpokes()" onfocus="TotalSpokesF(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="number-of-spokes" type="tel" value='36' /><br /></td>
        </tr><tr>
          <td><label class="label" for="number-of-crossings">Nr. of crossings gear side:</label></td>
          <td><input onchange="validate()" onkeyup="HelpCrossG()" onfocus="CrossG_F(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="number-of-crossings"          type="tel" value='3' /></td>
        </tr><tr>
          <td><label class="label" for="number-of-crossings-non-gear">Nr. of crossings non-gear side:</label></td>
          <td><input onchange="validate()" onkeyup="HelpCrossNG()" onfocus="CrossNG_F(this)" onfocusout="FocusOut(this)" class="inputfield" size="5" id="number-of-crossings-non-gear" type="tel" value='3' /></td>
       </tr><tr>
          <td colspan="2">Group pattern:&nbsp;&nbsp;
            <input onchange="PatternClick()" onclick="PatternClick()" type="radio" id="crossing"    name="pattern">        <label class="label" for="crossing">crossing</label>
            <input onchange="PatternClick()" onclick="PatternClick()" type="radio" id="noncrossing" name="pattern" checked><label class="label" for="noncrossing">non-crossing</label>
          </td>
        </tr><tr class="small">
          <td>&nbsp;</td>
        </tr><tr>
          <td><label class="label" for="spokes-per-group">Nr. of spokes per group:</label></td>
          <td><input onchange="display()" onkeyup="SPG_F(this)" onfocus="SPG_F(this)" onfocusout="validate();FocusOut(this)" class="inputfield" size="5" id="spokes-per-group" type="tel" value='1' /></td>
        </tr><tr id="ValidGroupNumbers" style="visibility:collapse">
          <td colspan="2" style="color:blue;">Valid numbers: 1,2,4</td>
        </tr><tr id="NumberOfSpokesDivision" style="visibility:collapse">
          <td colspan="2" style="color:blue;">"NumberOfSpokes" should be a<br>multiple of "SpokesPerGroup".</td>
        </tr><tr>
          <td colspan="2" id="delta" style="visibility:collapse"></td>
        </tr><tr id="distance2a" style="visibility:collapse">
          <td colspan="2">Spoke 1&nbsp;&nbsp;
            <input onchange="SideClick()" onclick="SideClick()" type="radio" id="gear"    name="side">        <label for="gear"> gear side</label>
            <input onchange="SideClick()" onclick="SideClick()" type="radio" id="nongear" name="side" checked><label for="nongear"> non-gear side</label>
          </td>

        </tr><tr id="distance2b" style="visibility:collapse">
          <td><label id="d12" class="label" for="distance12">Distance between spokes 1-2:</label></td>
          <td><input onchange="validate()" onkeyup="distance12_F(this)" onfocus="distance12_F(this)" onfocusout="validate();FocusOut(this)" class="inputfield2" size="5" id="distance12" type="tel" />&nbsp;mm</td>

        </tr><tr id="distance2c" style="visibility:collapse">
          <td>Spoke 2</td></p>

        </tr><tr id="distance3a" style="visibility:collapse">
          <td><label id="d23" class="label" for="distance23">Distance between spokes 2-3:</label></td>
          <td><input onchange="validate()" onkeyup="distance23_F(this)" onfocus="distance23_F(this)" onfocusout="validate();FocusOut(this)" class="inputfield3" size="5" id="distance23" type="tel" />&nbsp;mm</td>

        </tr><tr id="distance3b" style="visibility:collapse">
          <td>Spoke 3</td>

        </tr><tr id="distance4a" style="visibility:collapse">
          <td><label id="d34" class="label" for="distance34">Distance between spokes 3-4:</label></td>
          <td><input onchange="validate()" onkeyup="distance34_F(this)" onfocus="distance34_F(this)" onfocusout="validate();FocusOut(this)" class="inputfield4" size="5" id="distance34" type="tel" />&nbsp;mm</td>

        </tr><tr id="distance4b" style="visibility:collapse">
          <td>Spoke 4</td>

        </tr><tr id="distance6a" style="visibility:collapse">
          <td><label id="d45" class="label" for="distance45">Distance between spokes 4-5:</label></td>
          <td><input onchange="validate()" onkeyup="distance45_F(this)" onfocus="distance45_F(this)" onfocusout="validate();FocusOut(this)" class="inputfield6" size="5" id="distance45" type="tel" />&nbsp;mm</td>

        </tr><tr id="distance6b" style="visibility:collapse">
          <td>Spoke 5</td>

        </tr><tr id="distance6c" style="visibility:collapse">
          <td><label id="d56" class="label" for="distance56">Distance between spokes 5-6:</label></td>
          <td><input onchange="validate()" onkeyup="distance56_F(this)" onfocus="distance56_F(this)" onfocusout="validate();FocusOut(this)" class="inputfield6" size="5" id="distance56" type="tel" />&nbsp;mm</td>

        </tr><tr id="distance6d" style="visibility:collapse">
          <td>Spoke 6</td>

        </tr><tr class="small" >
          <td>&nbsp;</td>
        </tr><tr>
          <td id="MissingValue" style="color:red;visibility='hidden'">Missing value(s)!</td>
          <td><input disabled onclick="calculate()" id="button-calculate" name="" type="button" value="&nbsp;Calculate&nbsp;" /></td>
        </tr><tr id="Not_A_Number" style="color:blue;visibility:collapse">
          <td colspan="2">Not a number!</td>
        </tr><tr id="DistanceTooLarge" style="visibility:collapse">
          <td colspan="2" id="DistanceTooLargeTR" style="color:blue">Distance too large!</td>
        </tr><tr>
          <td colspan="2" style="font-size:22px;"><b>Spoke lengths:</b></td>
        <!-- calculation result -->
        </tr><tr id="resultLineA">
          <td><label id="lblResA">Spoke 1:</label></td>
          <td><input disabled class="output" id="resultA" size="5" type="tel" />&nbsp;mm</td>
        </tr><tr id="resultLineB">
          <td><label id="lblResB">Spoke 2:</label></td>
          <td><input disabled class="output" id="resultB" size="5" type="tel" />&nbsp;mm</td>
        </tr><tr id="resultLineC" style="visibility:collapse;">
          <td><label id="lblResC">Spoke 3:</label></td>
          <td><input disabled class="output" id="resultC" size="5" type="tel" />&nbsp;mm</td>
        </tr><tr id="resultLineD" style="visibility:collapse;">
          <td><label id="lblResD">Spoke 4:</label></td>
          <td><input disabled class="output" id="resultD" size="5" type="tel" />&nbsp;mm</td>
        </tr><tr id="resultLineE" style="visibility:collapse;">
          <td><label id="lblResE">Spoke 5:</label></td>
          <td><input disabled class="output" id="resultE" size="5" type="tel" />&nbsp;mm</td>
        </tr><tr id="resultLineF" style="visibility:collapse;">
          <td><label id="lblResF">Spoke 6:</label></td>
          <td><input disabled class="output" id="resultF" size="5" type="tel" />&nbsp;mm</td>
        <!-- messages -->
        </tr><tr id="RedProvideValue" style="visibility:collapse;">
          <td colspan="2" style="color:red">Please provide the fields marked in red.</td>
        </tr><tr id="BlueCorrectValue" style="visibility:collapse;">
          <td colspan="2" style="color:blue">Please correct the fields marked in blue.</td>
        </tr>
      </table></td><td id="space" style="padding:0;""><canvas id="canvas" style="border: none;"></canvas></td></tr>
    </table>
  </body>
</html>
<script type="text/javascript">

var Ca, Cb, D, D1a, D1b, N, M, A, Ka, Kb, Dr, crossing;
var AngleRim = [];
var AngleHub = [];
var HubGearSide = [];
var verbose = false;
var Sb;
var Length = [];
var screen = 0;
var distance = [];
var page_offset = 0;
var Delta=0, DeltaMax=0;
var ColourRed = "#FFA0A0";
var ColourBlue = "#0000FF";
var ColourLighterRed = "#FFE0E0";
var ColourLighterBlue = "#C0C0FF";

const LineWidth = 2;
const HelpScreenSize = 175;

function SetSpokeSides() {
    var side = (Sb==0) ? true : false;
    for( i=0; i<N; i++ ) {
        HubGearSide[i] = side;
        side = ! side; // toggle
    }
}

function onload() {
    document.querySelector('label[for="gear"]').style.color = ColourRed;
    document.querySelector('label[for="nongear"]').style.color = ColourBlue;
    if( validate() ) {
        calculate();
    } else {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
}

function reread() {
    A = document.getElementById("total-length-hub").value.replace(',', '.');        /*totalLengthHub*/
    if( isNaN(A) ) {
        A = 0;
    } else {
        A = parseFloat(A);
    }
    Ka = document.getElementById("non-gear-side").value.replace(',', '.');          /*nonGearSide*/
    if( isNaN(Ka) ) {
        Ka = 0;
    } else {
        Ka = parseFloat(Ka);
    }
    Kb = document.getElementById("gear-side").value.replace(',', '.');              /*gearSide*/
    if( isNaN(Kb) ) {
        Kb = 0;
    } else {
        Kb = parseFloat(Kb);
    }
    D1a = document.getElementById("hub-diameter-non-gear").value.replace(',', '.'); /*diameterNonGearSide*/
    if( isNaN(D1a) ) {
        D1a = 0;
    } else {
        D1a = parseFloat(D1a);
    }
    D1b = document.getElementById("hub-diameter-gear").value.replace(',', '.');     /*diameterGearSide*/
    if( isNaN(D1b) ) {
        D1b = 0;
    } else {
        D1b = parseFloat(D1b);
    }
    D = document.getElementById("internal-diameter").value.replace(',', '.');     /*internalDiameterRim*/
    if( isNaN(D) ) {
        D = 0;
    } else {
        D = parseFloat(D);
    }
    Dr = document.getElementById("rim-thickness").value.replace(',', '.');         /*rimThickness*/
    if( isNaN(Dr) ) {
        Dr = 0;
    } else {
        Dr = parseFloat(Dr);
    }
    N = document.getElementById("number-of-spokes").value;                         /*numberSpokes*/
    if( isNaN(N) ) {
        N = 0;
    } else {
        N = parseFloat(N);
    }
    Ca = document.getElementById("number-of-crossings-non-gear").value;           /*crossingsNonGear*/
    if( isNaN(Ca) ) {
        Ca = 0;
    } else {
        Ca = parseFloat(Ca);
        Ca = Math.round(Ca);
        if( Ca > Math.trunc( N / 8 )-1 ) {
            Ca = Math.trunc( N / 8 )-1;
            if( Ca < 0 ) {
                document.getElementById("number-of-crossings-non-gear").value = "";
            } else {
                document.getElementById("number-of-crossings-non-gear").value = Ca;
            }
        } else if( Ca < 0 ) {
            Ca = 0;
        }
    }
    Cb = document.getElementById("number-of-crossings").value;                    /*crossingsGear*/
    if( isNaN(Cb) ) {
        Cb = 0;
    } else {
        Cb = parseFloat(Cb);
        Cb = Math.round(Cb);
        if( Cb > Math.trunc( N / 8 )-1 ) {
            Cb = Math.trunc( N / 8 )-1;
            if( Cb < 0 ) {
                document.getElementById("number-of-crossings").value = "";
            } else {
                document.getElementById("number-of-crossings").value = Cb;
            }
        } else if( Cb < 0 ) {
            Cb = 0;
        }
    }
    M = document.getElementById("spokes-per-group").value;                        /*spokes per group*/
    if( isNaN(M) ) {
        M = 0;
    } else {
        M = parseFloat(M);
    }
    distance == [];
    distance[0] = document.getElementById("distance12").value.trim().replace(',', '.');
    if( isNaN(distance[0]) ) {
        distance[0] = 0;
    } else {
        distance[0] = parseFloat(distance[0]);
    }
    distance[1] = document.getElementById("distance23").value.trim().replace(',', '.');
    if( isNaN(distance[1]) ) {
        distance[1] = 0;
    } else {
        distance[1] = parseFloat(distance[1]);
    }
    distance[2] = document.getElementById("distance34").value.trim().replace(',', '.');
    if( isNaN(distance[2]) ) {
        distance[2] = 0;
    } else {
        distance[2] = parseFloat(distance[2]);
    }
    distance[3] = document.getElementById("distance45").value.trim().replace(',', '.');
    if( isNaN(distance[3]) ) {
        distance[3] = 0;
    } else {
        distance[3] = parseFloat(distance[3]);
    }
    distance[4] = document.getElementById("distance56").value.trim().replace(',', '.');
    if( isNaN(distance[4]) ) {
        distance[4] = 0;
    } else {
        distance[4] = parseFloat(distance[4]);
    }
    crossing = (document.getElementById("crossing").checked?true:false);
    Sb = (document.getElementById("gear").checked ? 0 : 1 );  //Sb = 0 first spoke on gear side, Sb = 1 first spoke on non-gear
    Ca = (crossing) ? Ca : -Ca;
    Cb = (crossing) ? Cb : -Cb;
    Delta = Math.PI * D / N;
    DeltaMax = (M-1) * Delta;
}

function display() {
    if( validate() ) {
        // initial calculations
        var Za       = A/2 - Ka /*Umbrella heigth non-gear*/
        var Zb       = A/2 - Kb /*Umbrella heigth gear*/
        var ra       = D1a/2    /*Hub radius non-gear*/
        var rb       = D1b/2    /*Hub radius non-gear*/
        var R        = D/2;      //% Rim radius (inner side), so remove Dr
        var h;
        if( M == 3 ) {
            h = 2 * M / 2;                 // % Temp
        } else {
            h = M / 2;
        }
        var N2 = N / 2;
        var r = [];
        var Z = [];
        var C = [];
        var X = [];
        var Kfactor = [];
        var Chub;
        var Sigma;
        if( verbose ) {
            console.clear();
            console.log("##################################################");
            console.log("ingevoerd:");
            console.log("##################################################");
            console.log("A           = " + A        );
            console.log("Ka          = " + Ka       );
            console.log("Kb          = " + Kb       );
            console.log("D1a         = " + D1a      );
            console.log("D1b         = " + D1b      );
            console.log("D           = " + D        );
            console.log("R           = " + R        );
            console.log("N           = " + N        );
            console.log("Ca          = " + Ca       );
            console.log("Cb          = " + Cb       );
            console.log("M           = " + M        );
            console.log("M         = " + M      );
            console.log("Sb          = " + Sb       );
            console.log("crossing    = " + crossing );
        }
        if( verbose ) {
            console.log("distance[0] = " + distance[0] );
            console.log("distance[1] = " + distance[1] );
            console.log("distance[2] = " + distance[2] );
            console.log("distance[3] = " + distance[3] );
            console.log("distance[4] = " + distance[4] );
            console.log("#################################################");
            console.log("berekend:");
            console.log("#################################################");
            console.log("Za          = " + Za );
            console.log("Zb          = " + Zb );
            console.log("ra          = " + ra );
            console.log("rb          = " + rb );
            console.log("R           = " + R  );
            console.log("Delta       = " + Delta  );
            console.log("Delta/2     = " + Delta/2  );
        }
        //--------------------------------------------------------------
        // Filling arrays hub radius r, height Z and crossings C
        if( Sb == 0 ) { // First spoke on gear side
            for( i2 = 0; i2 <= N2; i2++ ) { // do i2 = 1, N2
                i = 2 * ( i2 - 1 );
                r[i + 1] = ra;
                r[i + 2] = rb;
                Z[i + 1] = Za;
                Z[i + 2] = Zb;
                C[i + 1] = Ca;
                C[i + 2] = Cb;
            }
        } else { // First spoke on non-gear side
            for( i2 = 0; i2 <= N2; i2++ ) { // do i2 = 1, N2
                i = 2 * ( i2 - 1 );  // Flip parameters
                r[i + 1] = rb;  // Hub radius
                r[i + 2] = ra;
                Z[i + 1] = Zb;  // Hub Heigth
                Z[i + 2] = Za;
                C[i + 1] = Cb;  // Crossings
                C[i + 2] = Ca;
            }
        }
        N4 = N / 4;
        for( i4 = 0; i4 < N4; i4++ ) {
            i = 4 * ( i4 );
            C[i+2] = -C[i+2]; // spokes 3 and 4 have opposite signs
            C[i+3] = -C[i+3];
        }
        //--------------------------------------------------------------
        // Fill positions X
        var Width = 0;
        for( i = 0; i < M-1; i++ ) { //do i = 1, M-1
            Width = Width + distance[i];
        }
        distance[M-1] = M * Delta - Width; // The missing Distance
        if( verbose ) {
            console.log( "distance[" + (M-1) + "] = " + distance[M-1] );
        }
        k = M-1;
        var NG = N / M;                // NG = Number of groups
        for( j = 1; j < NG; j++ ) {    // do j = 1, NG
            for( i = 0; i < M; i++ ) { // do i = 1, M
                k = k + 1;
                distance[k] = distance[i] // Fill all distances
            }
        }
        X[0] = 0;
        for( i = 1; i < N; i++ ) {     // do i = 2, N
            X[i] = X[i-1] + distance[i-1] // Calculate positions
        }
        for( i = 0; i < N; i++ ) {     // do i = 2, N
            if( verbose ) {
                console.log(   "X[" + i + "] = " + X[i].toFixed(2)
                           + "\tr[" + i + "] = " + r[i].toFixed(2)
                           + "\tZ[" + i + "] = " + Z[i].toFixed(2)
                           + "\tC[" + i + "] = " + C[i]
                           + "\tdistance[" + i + "] = " + distance[i].toFixed(2) );
            }
        }

        // The middle of two nearest hub-holes (gear and non-gear)
        // is aligned towards position Offset on the rim

        //h = 2; // Offset_index; ################################################# invoer maken
        //Sigma = ( X[h-1] + X[h] ) / 2;
        if( true ) { // ventiel midden in de groep
            Sigma = ( X[0] + X[M-1] ) / 2;
        } else { // tussen groepen
            Sigma = ( X[M] + X[M-1] ) / 2;
        }
        Chub = -( M-1 ) / 4;
        if( verbose ) {
            console.log( "Sigma = " + Sigma );
            console.log( "Chub  = " + Chub );
        }

        //--------------------------------------------------------------
        // Spoke length calculation
        var DeltaHub = 2 * Math.PI / N;        // Angle between Hub holes (N holes)
        var AverageHub = (M-1) / 2 * DeltaHub; // Average angle of first M Hub holes (determines Hub rotation)
        for( i = 0; i < N; i++ ) {
            AngleHub[i] = i*DeltaHub + C[i]*2*DeltaHub - AverageHub; //  AngleHub[i] = (C[i] + i/2 - (M-1)/4)*2*DeltaHub
                                                                     //  Including active Hub rotation over angle AverageHub
            AngleRim[i] = X[i] / R;
        }
        var Sum = 0;
        for( i = 0; i < M; i++ ) {
            Sum = Sum + AngleRim[i];
        }
        AverageRim = Sum / M;  // Average angle of the first M Rim holes
        for( i = 0; i < N; i++ ) {
            AngleRim[i] = AngleRim[i] - AverageRim; // Active rotation of Rim
        }
        RDr = R + Dr; // Radius + Rim thickness
        for( i = 0; i < N; i++ ) {
            Beta = AngleHub[i] - AngleRim[i];
            Kfactor[i] = Beta / (2*DeltaHub);      // Kfactor[i] = C[i] + i/2 - (M-1)/4 - (X[i]/R - Sigma/R)/(2*DeltaHub) =
            L2 = Math.pow(RDr,2) + Math.pow(r[i],2) + Math.pow(Z[i],2) - 2 * RDr * r[i] * Math.cos(Beta);  // Three-dimensional Pythagoras / Cosine rule
            Length[i] = Math.sqrt(L2);
        }
        if( verbose ) {
            console.log( "AngleHub[0] AngleRim[0] " + AngleHub[0] + " " + AngleRim[0] );
            console.log( "AngleHub[1] AngleRim[1] " + AngleHub[1] + " " + AngleRim[1] );
            console.log( "AngleHub[2] AngleRim[2] " + AngleHub[2] + " " + AngleRim[2] );
            console.log( "AngleHub[3] AngleRim[3] " + AngleHub[3] + " " + AngleRim[3] );
        }
        for( i = 0; i < N; i++ ) {
            Sum = 0;
            if( verbose ) {
                console.log( "i = " + i
                           + "\tKfactor[" + i + "]= "+Kfactor[i].toFixed(2)
                           + "\tBeta= "+Beta.toFixed(2)
                           + "\tL2= "+L2.toFixed(1)
                           + "\tLength[" + i + "]= " + Length[i].toFixed(0)
                           + "\tAngleR[" + i + "]= " + AngleRim[i].toFixed(1)
                           + "\tAngleH[" + i + "]= " + AngleHub[i].toFixed(1)
                           );
            }
        }
        SetSpokeSides();
        WriteResults();

        // all valid now, calculation button is available
        document.getElementById("button-calculate").disabled = false;
    } else {
        //document.getElementById("button-calculate").disabled = true;
    }
}

function validate() {
    reread();
    var retval = true;
    document.getElementById("resultLineA").style.visibility = "collapse";
    document.getElementById("resultLineB").style.visibility = "collapse";
    document.getElementById("resultLineC").style.visibility = "collapse";
    document.getElementById("resultLineD").style.visibility = "collapse";
    document.getElementById("resultLineE").style.visibility = "collapse";
    document.getElementById("resultLineF").style.visibility = "collapse";
    var M    = document.getElementById("spokes-per-group");
    var nos    = document.getElementById("number-of-spokes");
    var msg1a  = document.getElementById("RedProvideValue");
    var msg1b  = document.getElementById("BlueCorrectValue");
    var msg2   = document.getElementById("MissingValue");
    var msg3   = document.getElementById("Not_A_Number");
    var msg4   = document.getElementById("ValidGroupNumbers");
    var msg5   = document.getElementById("DistanceTooLarge");
    var msg6   = document.getElementById("NumberOfSpokesDivision");
    var fields  = document.getElementsByClassName('inputfield');
    var labels = document.getElementsByClassName('label');
    msg1a.style.visibility = "collapse";
    msg1b.style.visibility = "collapse";
    msg2.style.visibility  = "hidden"; // this line should stay visible, as it contains the calc. button
    msg3.style.visibility  = "collapse";
    msg4.style.visibility  = "collapse";
    msg5.style.visibility  = "collapse";
    msg6.style.visibility  = "collapse";
    M.value = M.value.trim().replace(',', '.');

    // check all required fields
    switch( M.value ) {
        case "2":
            fieldclass = ".inputfield, .inputfield2";
            break;
        //case "3":
        //    fieldclass = ".inputfield, .inputfield2, .inputfield3";
            break;
        case "4":
            fieldclass = ".inputfield, .inputfield2, .inputfield3, .inputfield4";
            break;
        //case "6":
        //    fieldclass = ".inputfield, .inputfield2, .inputfield3, .inputfield4, .inputfield6";
            break;
        default:
            fieldclass = ".inputfield";
    }
    var fields = document.querySelectorAll(fieldclass);
    for( var i=0; i<fields.length; i++ ) {
        fields[i].value = fields[i].value.trim();
        for( var j = 0; j < labels.length; j++ ) {
            if( labels[j].htmlFor == fields[i].id ) {
                labels[j].style.color = "#404040";
                break;
            }
        }
        if( fields[i].value == "" ) {
            retval = false;
            msg1a.style.visibility = "visible";
            msg2.style.visibility = "visible";
            for( var j = 0; j < labels.length; j++ ) {
                if( labels[j].htmlFor == fields[i].id ) {
                    labels[j].style.color = ColourRed;
                    break;
                }
            }
        }
        if( fields[i].value != "" ) {
            fields[i].value = fields[i].value.replace(",",".");
            if( isNaN(parseFloat(fields[i].value)) || (fields[i].value.split(".").length - 1) > 1 ) {
                retval = false;
                msg3.style.visibility = "visible";
                msg1b.style.visibility = "visible";
                for( var j = 0; j < labels.length; j++ ) {
                    if( labels[j].htmlFor == fields[i].id ) {
                        labels[j].style.color = ColourBlue;
                        break;
                    }
                }
            }
        }
    }

    // number of spokes must be a multiple of spokes per group
    if( ( parseFloat(nos.value) % parseFloat(M.value) ) != 0 ) {
        msg6.style.visibility = "visible";
        msg1b.style.visibility = "visible";
        retval = false;
    }

    switch(M.value) {
        case "1":
            show_group1();
            break;
        case "2":
            if( retval == true ) {
                retval = show_group2();
            } else {
                show_group2();
            }
            break;
        case "3":
            retval = false;
            msg4.style.visibility = "visible";
            hide_group();
        //    if( retval == true ) {
        //        retval = show_group3();
        //    } else {
        //        show_group3();
        //    }
            break;
        case "4":
            if( retval == true ) {
                retval = show_group4();
            } else {
                show_group4();
            }
            break;
        case "5":
            retval = false;
            msg4.style.visibility = "visible";
            hide_group();
            break;
        case "6":
            retval = false;
            msg4.style.visibility = "visible";
            hide_group();
        //    if( retval == true ) {
        //        retval = show_group6();
        //    } else {
        //        show_group6();
        //    }
            break;
        default:
            retval = false;
            msg1b.style.visibility = "visible";
            msg4.style.visibility = "visible";
            for( var j = 0; j < labels.length; j++ ) {
                if( labels[j].htmlFor == "spokes-per-group" ) {
                    labels[j].style.color = ColourBlue;
                }
            }
            hide_group();
    }
    //var tmp = group_fits();
    //if( tmp == false ) {
    //    retval = false;
    //}
    return retval;
}

function WriteResults() {
        document.getElementById("resultA").value = Length[0].toFixed(0);
        document.getElementById("resultB").value = Length[1].toFixed(0);
        document.getElementById("resultC").value = Length[2].toFixed(0);
        document.getElementById("resultD").value = Length[3].toFixed(0);
        if( M == 1 ||  M == 2) {
            document.getElementById("resultLineA").style.visibility = "visible";
            document.getElementById("resultLineB").style.visibility = "visible";
            document.getElementById("resultLineC").style.visibility = "visible";
            document.getElementById("resultLineD").style.visibility = "visible";
            document.getElementById("resultLineE").style.visibility = "collapse";
            document.getElementById("resultLineF").style.visibility = "collapse";
            document.getElementById("lblResA").innerHTML = "Spoke 1 ("+ N/4 +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            document.getElementById("lblResB").innerHTML = "Spoke 2 ("+ N/4 +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
            document.getElementById("lblResC").innerHTML = "Spoke 3 ("+ N/4 +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            document.getElementById("lblResD").innerHTML = "Spoke 4 ("+ N/4 +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
        } else if( M == 3 ) {
            hide_group();
            //document.getElementById("resultE").value = Length[4].toFixed(0);
            //document.getElementById("resultF").value = Length[5].toFixed(0);

            //document.getElementById("resultLineA").style.visibility = "visible";
            //document.getElementById("resultLineB").style.visibility = "visible";
            //document.getElementById("resultLineC").style.visibility = "visible";
            //document.getElementById("resultLineD").style.visibility = "visible";
            //document.getElementById("resultLineE").style.visibility = "visible";
            //document.getElementById("resultLineF").style.visibility = "visible";
            //document.getElementById("lblResA").innerHTML = "Spoke 1 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            //document.getElementById("lblResB").innerHTML = "Spoke 2 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
            //document.getElementById("lblResC").innerHTML = "Spoke 3 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            //document.getElementById("lblResD").innerHTML = "Spoke 4 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
            //document.getElementById("lblResE").innerHTML = "Spoke 5 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            //document.getElementById("lblResF").innerHTML = "Spoke 6 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
        } else if( M == 4 ) {
            document.getElementById("resultLineA").style.visibility = "visible";
            document.getElementById("resultLineB").style.visibility = "visible";
            document.getElementById("resultLineC").style.visibility = "visible";
            document.getElementById("resultLineD").style.visibility = "visible";
            document.getElementById("resultLineE").style.visibility = "collapse";
            document.getElementById("resultLineF").style.visibility = "collapse";
            document.getElementById("lblResA").innerHTML = "Spoke 1 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            document.getElementById("lblResB").innerHTML = "Spoke 2 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
            document.getElementById("lblResC").innerHTML = "Spoke 3 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            document.getElementById("lblResD").innerHTML = "Spoke 4 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
        } else if( M == 5 && M == 6 ) {
            hide_group();
            //document.getElementById("resultE").value = Length[4].toFixed(0);
            //document.getElementById("resultF").value = Length[5].toFixed(0);

            //document.getElementById("resultLineA").style.visibility = "visible";
            //document.getElementById("resultLineB").style.visibility = "visible";
            //document.getElementById("resultLineC").style.visibility = "visible";
            //document.getElementById("resultLineD").style.visibility = "visible";
            //document.getElementById("resultLineE").style.visibility = "visible";
            //document.getElementById("resultLineF").style.visibility = "visible";
            //document.getElementById("lblResA").innerHTML = "Spoke 1 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            //document.getElementById("lblResB").innerHTML = "Spoke 2 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
            //document.getElementById("lblResC").innerHTML = "Spoke 3 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            //document.getElementById("lblResD").innerHTML = "Spoke 4 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
            //document.getElementById("lblResE").innerHTML = "Spoke 5 ("+ N/M +"x) "+ (Sb==0?"gear":"non-gear") +" side:";
            //document.getElementById("lblResF").innerHTML = "Spoke 6 ("+ N/M +"x) "+ (Sb==0?"non-gear":"gear") +" side:";
        }
}

function show_group1() {
    hide_group();
    var M = document.getElementById("spokes-per-group");
    var nos = document.getElementById("number-of-spokes");
    var diam = document.getElementById("internal-diameter");
    var ena = false;
    M.value = M.value.trim();
    if( M.value == "1" ) {
        nos.value = nos.value.trim();
        nos.value = nos.value.replace(",",".");
        if( nos.value != "" && !isNaN(parseFloat(nos.value)) || (nos.value.split(".").length - 1) == 0 ) {
            diam.value = diam.value.trim();
            diam.value = diam.value.replace(",",".");
            if( diam.value != "" && !isNaN(parseFloat(diam.value)) ) {
                if( parseFloat(nos.value) > 0.0 && parseFloat(diam.value) > 0.0 ) {
                    var dist = parseFloat(diam.value) * Math.PI / parseFloat(nos.value);
                    document.getElementById("delta").style.visibility = "visible";
                    document.getElementById("delta").innerHTML = "Distance between spokes: <b>" + dist.toFixed(1) +"</b> mm";
                }
            }
        }
    }
}

function hide_group() {
    document.getElementById("delta"  ).style.visibility = "collapse";
    document.getElementById("distance2a").style.visibility = "visible";
    document.getElementById("distance2b").style.visibility = "collapse";
    document.getElementById("distance2c").style.visibility = "collapse";
    document.getElementById("distance3a").style.visibility = "collapse";
    document.getElementById("distance3b").style.visibility = "collapse";
    document.getElementById("distance4a").style.visibility = "collapse";
    document.getElementById("distance4b").style.visibility = "collapse";
    document.getElementById("distance6a").style.visibility = "collapse";
    document.getElementById("distance6b").style.visibility = "collapse";
    document.getElementById("distance6c").style.visibility = "collapse";
    document.getElementById("distance6d").style.visibility = "collapse";
    document.getElementById("distance12").style.visibility = "collapse";
    document.getElementById("distance23").style.visibility = "collapse";
    document.getElementById("distance34").style.visibility = "collapse";
    document.getElementById("distance45").style.visibility = "collapse";
    document.getElementById("distance56").style.visibility = "collapse";
}

function spoke_test( field ) {
    var retval = true;
    var labels = document.getElementsByClassName('label');
    var val = parseFloat(document.getElementById(field).value.trim().replace(',', '.') );
    if( val > DeltaMax ) {
        retval = false;
        var msg5 = document.getElementById("DistanceTooLarge");
        var msg1b = document.getElementById("BlueCorrectValue");
        var lbl = document.getElementById("DistanceTooLargeTR");
        lbl.innerHTML = "Distance too large! (Max. " + DeltaMax.toFixed(1) + "mm)";
        msg5.style.visibility = "visible";
        msg1b.style.visibility = "visible";
        for( var j = 0; j < labels.length; j++ ) {
            if( labels[j].htmlFor == field ) {
                labels[j].style.color = ColourBlue;
                break;
            }
        }
    }
    return retval;
}

function DeltaMaxTest() {
    var retval = true;
    var msg5 = document.getElementById("DistanceTooLarge");
    var msg1b = document.getElementById("BlueCorrectValue");
    var lbl = document.getElementById("DistanceTooLargeTR");
    var labels = document.getElementsByClassName('label');
    if( M == 2 ) {
        if( distance[0] > DeltaMax ) {
            lbl.innerHTML = "Distance too large! (Max. " + DeltaMax.toFixed(1) + "mm)";
            msg5.style.visibility = "visible";
            msg1b.style.visibility = "visible";
            retval = false;
        }
    } else if( M == 4 ) {
        if( (distance[0] + distance[1] + distance[2]) > DeltaMax ) {
            lbl.innerHTML = "Sum of distances too large! (Max. " + ((M-1)*Delta).toFixed(1) + "mm)";
            msg5.style.visibility = "visible";
            msg1b.style.visibility = "visible";
            retval = false;
        }
    }
    if( retval == false ) {
        var caption = new Array("d12","d23","d34","d45","d56");
        for( var i = 0; i < caption.length; i++ ) {
            document.getElementById(caption[i]).style.color = ColourBlue;
        }
        caption.length = 0;
    }
    return retval;
}

function show_group2() {
    var retval = DeltaMaxTest();
    hide_group();
    document.getElementById("distance2a").style.visibility = "visible";
    document.getElementById("distance2b").style.visibility = "visible";
    document.getElementById("distance2c").style.visibility = "visible";
    document.getElementById("distance12").style.visibility = "visible";
    if( retval == false ) {
        spoke_test('distance12');
        return false;
    } else {
        return spoke_test('distance12');
    }
}

function show_group3() {
    var retval = show_group2();
    document.getElementById("distance3a").style.visibility = "visible";
    document.getElementById("distance3b").style.visibility = "visible";
    document.getElementById("distance23").style.visibility = "visible";
    if( retval == false ) {
        spoke_test('distance23');
        return false;
    } else {
        return spoke_test('distance23');
    }
}

function show_group4() {
    var retval = show_group3();
    document.getElementById("distance4a").style.visibility = "visible";
    document.getElementById("distance4b").style.visibility = "visible";
    document.getElementById("distance34").style.visibility = "visible";
    if( retval == false ) {
        spoke_test('distance34');
        return false;
    } else {
        return spoke_test('distance34');
    }
}

function show_group6() {
    var retval = show_group4();
    document.getElementById("distance6a").style.visibility = "visible";
    document.getElementById("distance6b").style.visibility = "visible";
    document.getElementById("distance6c").style.visibility = "visible";
    document.getElementById("distance6d").style.visibility = "visible";
    document.getElementById("distance45").style.visibility = "visible";
    document.getElementById("distance56").style.visibility = "visible";
    if( retval == false ) {
        spoke_test('distance45')
        spoke_test('distance56');
        return false;
    } else {
        if( ! spoke_test('distance45') ) {
            spoke_test('distance56');
            return false;
        } else {
            return  spoke_test('distance56');
        }
    }
}

function ra_de(val) { // RADIANS 2 DEGREES
    return ((eval(val))*(180/Math.PI));
}

function de_ra(val) { // DEGREES 2 RADIANS
    return ((eval(val))*(Math.PI/180));
}

var done = false;
function resize() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const w = window, d = document, e = d.documentElement, g = d.getElementsByTagName('body')[0];
    var X, Y;
    X = (w.innerWidth || e.clientWidth || g.clientWidth),
    Y = (w.innerHeight|| e.clientHeight|| g.clientHeight) - 100;
    if( X < Y ) {
        ctx.canvas.width  = X;
        ctx.canvas.height = X;
    } else {
        ctx.canvas.width  = Y;
        ctx.canvas.height = Y;
    }
    switch( screen ) {
        case 0:
            clear();
            break;
        case 1:
            HelpTotalHub();
            break;
        case 2:
            HelpSizeNonGear();
            break;
        case 3:
            HelpSizeGear();
            break;
        case 4:
            HelpDiamNonGear();
            break;
        case 5:
            HelpDiamNonGear();
            break;
        case 6:
            HelpIntRimDiam();
            break;
        case 7:
            HelpRimThick();
            break;
        case 8:
            TotalSpokes();
            break;
        case 9:
            calculate();
            break;
        default:
            clear();
    }
    if( ! done ) {
        done = true;
        display();
        Pattern();
    }
}

function wheel() {
    if( validate() ) {
        display();
        Pattern();
    } else {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
}

var again = true;
function calculate() {
    if( again == true ) {
        again = false;
        resize();
    }
    screen = 9;
    wheel();
}

function FocusOut(x) {
    x.style.background = "white";
}

function scaleX( x ) {
    // scale from 300*300 to canvas.width, canvas.height
    const canvas = document.getElementById("canvas");
    return( parseFloat(x) * canvas.width / 300 );
}

function scaleY( y ) {
    // scale from 300*300 to canvas.width, canvas.height
    const canvas = document.getElementById("canvas");
    return( parseFloat(y) * canvas.height / 300);
}

function PrintHub(ctx) {
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.moveTo( scaleX(20 ), scaleY(144) );
    ctx.lineTo( scaleX(45 ), scaleY(144) );
    ctx.lineTo( scaleX(45 ), scaleY(139) );
    ctx.lineTo( scaleX(77 ), scaleY(139) );
    ctx.lineTo( scaleX(77 ), scaleY(98 ) );
    ctx.lineTo( scaleX(81 ), scaleY(98 ) );
    ctx.lineTo( scaleX(81 ), scaleY(107) );
    ctx.lineTo( scaleX(207), scaleY(107) );
    ctx.lineTo( scaleX(207), scaleY(98 ) );
    ctx.lineTo( scaleX(211), scaleY(98 ) );
    ctx.lineTo( scaleX(211), scaleY(138) );
    ctx.lineTo( scaleX(216), scaleY(138) );
    ctx.lineTo( scaleX(216), scaleY(89 ) );
    ctx.lineTo( scaleX(221), scaleY(89 ) );
    ctx.lineTo( scaleX(221), scaleY(139) );
    ctx.lineTo( scaleX(254), scaleY(139) );
    ctx.lineTo( scaleX(254), scaleY(144) );
    ctx.lineTo( scaleX(281), scaleY(144) );
    ctx.lineTo( scaleX(281), scaleY(155) );
    ctx.lineTo( scaleX(254), scaleY(155) );
    ctx.lineTo( scaleX(254), scaleY(160) );
    ctx.lineTo( scaleX(221), scaleY(160) );
    ctx.lineTo( scaleX(221), scaleY(210) );
    ctx.lineTo( scaleX(216), scaleY(210) );
    ctx.lineTo( scaleX(216), scaleY(161) );
    ctx.lineTo( scaleX(211), scaleY(161) );
    ctx.lineTo( scaleX(211), scaleY(201) );
    ctx.lineTo( scaleX(207), scaleY(201) );
    ctx.lineTo( scaleX(207), scaleY(192) );
    ctx.lineTo( scaleX(81 ), scaleY(192) );
    ctx.lineTo( scaleX(81 ), scaleY(201) );
    ctx.lineTo( scaleX(77 ), scaleY(201) );
    ctx.lineTo( scaleX(77 ), scaleY(160) );
    ctx.lineTo( scaleX(45 ), scaleY(160) );
    ctx.lineTo( scaleX(45 ), scaleY(155) );
    ctx.lineTo( scaleX(20 ), scaleY(155) );
    ctx.lineTo( scaleX(20 ), scaleY(144) );
    ctx.stroke();
}

function SizeTotalHub(x) {
    screen = 1;
    x.style.background = "yellow";
    HelpTotalHub();
}

function HelpTotalHub() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    var input = document.getElementById("total-length-hub");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    PrintHub(ctx);
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo( scaleX(44 ), scaleY(130) );
    ctx.lineTo( scaleX(44 ), scaleY(61 ) );
    ctx.lineTo( scaleX(255), scaleY(61 ) );
    ctx.lineTo( scaleX(255), scaleY(130) );
    ctx.stroke();
    ctx.restore();
}

function SizeNonGear(x) {
    screen = 2;
    x.style.background = "yellow";
    HelpSizeNonGear();
}

function HelpSizeNonGear() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    var input = document.getElementById("non-gear-side");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    PrintHub(ctx);
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo( scaleX(44 ), scaleY(130) );
    ctx.lineTo( scaleX(44 ), scaleY(61 ) );
    ctx.lineTo( scaleX(75 ), scaleY(61 ) );
    ctx.lineTo( scaleX(75 ), scaleY(130) );
    ctx.stroke();
    ctx.restore();
}

function SizeGear(x) {
    screen = 3;
    x.style.background = "yellow";
    HelpSizeGear();
}

function HelpSizeGear() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    var input = document.getElementById("gear-side");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    PrintHub(ctx);
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo( scaleX(213), scaleY(130) );
    ctx.lineTo( scaleX(213), scaleY(61 ) );
    ctx.lineTo( scaleX(255), scaleY(61 ) );
    ctx.lineTo( scaleX(255), scaleY(130) );
    ctx.stroke();
    ctx.restore();
}

function DiamNonGear(x) {
    clear();
    x.style.background = "yellow";

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    var input = document.getElementById("hub-diameter-non-gear");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    PrintHub(ctx);
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo( scaleX(70 ),  scaleY(102) );
    ctx.lineTo( scaleX(8  ),  scaleY(102) );
    ctx.lineTo( scaleX(8  ),  scaleY(197) );
    ctx.lineTo( scaleX(70 ),  scaleY(197) );
    ctx.stroke();
    ctx.restore();
}

function DiamGear(x) {
    clear();
    x.style.background = "yellow";

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    var input = document.getElementById("hub-diameter-gear");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "black";
    PrintHub(ctx);
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo( scaleX(200),  scaleY(102) );
    ctx.lineTo( scaleX(158),  scaleY(102) );
    ctx.lineTo( scaleX(158),  scaleY(198) );
    ctx.lineTo( scaleX(200),  scaleY(198) );
    ctx.stroke();
    ctx.restore();
}

function IntRimDiam(x) {
    screen = 6;
    x.style.background = "yellow";
    HelpIntRimDiam();
}

function HelpIntRimDiam() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    var input = document.getElementById("internal-diameter");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2.3, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, 4, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, 20, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo(  scaleX(21 ), canvas.height/2 );
    ctx.lineTo(  scaleX(279), canvas.height/2 );
    ctx.stroke();
    ctx.restore();
}


function RimThick(x) {
    screen = 7;
    x.style.background = "yellow";
    HelpRimThick();
}

function HelpRimThick() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = "100";
    canvas.height = "100";

    var input = document.getElementById("rim-thickness");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2.2, 0, Math.PI/2.2);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2.2, Math.PI/1.81, Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2.5, 0, Math.PI/2.23);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2.5, Math.PI/1.79, Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo( scaleX(14  ), canvas.height/2 );
    ctx.lineTo( scaleX(30  ), canvas.height/2 );
    ctx.stroke();
    ctx.moveTo( scaleX(270), canvas.height/2 );
    ctx.lineTo( scaleX(286), canvas.height/2 );
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.moveTo( scaleX(128), scaleY(268) );
    ctx.lineTo( scaleX(128), scaleY(285) );
    ctx.moveTo( scaleX(170), scaleY(268) );
    ctx.lineTo( scaleX(170), scaleY(285) );
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.moveTo( scaleX(165),  scaleY(268) );
    ctx.lineTo( scaleX(150),  scaleY(268) );
    ctx.lineTo( scaleX(150),  scaleY(285) );
    ctx.lineTo( scaleX(165),  scaleY(285) );
    ctx.stroke();
    ctx.restore();
}

function TotalSpokesF(x) {
    reread();
    screen = 8;
    x.style.background = "yellow";
    TotalSpokes();
}

function TotalSpokes() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    var input = document.getElementById("number-of-spokes");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";
    reread();
    ctx.lineWidth = LineWidth;
    ctx.save();

    ctx.beginPath();
    ctx.strokeStyle = "black";
    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const outerRadius = canvas.width * 0.49;
    var innerRadius = scaleX(30);
    ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(centerX, centerY, scaleX(4), 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    const part = (2 * Math.PI) / N;
    for( i=0; i<N; i++ ) {
        const angle = i * part;
        ctx.moveTo(centerX + innerRadius * Math.cos(angle), centerY + innerRadius * Math.sin(angle));
        ctx.lineTo(centerX + outerRadius * Math.cos(angle), centerY + outerRadius * Math.sin(angle));
    }
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI);
    ctx.stroke();
}

function SPG_F( x ) {
    x.style.background = "yellow";
    SPG();
}

function SPG() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;
    var input = document.getElementById("spokes-per-group");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";
    reread();
    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const outerRadius = canvas.width * 0.49;
    const innerRadius = scaleX(30);
    ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(centerX, centerY, scaleX(4), 0, 2 * Math.PI);
    ctx.stroke();
    var angle;
    if( M == 1 ) {
        const part = (2 * Math.PI) / N;
        for( i=0; i<N/M; i++ ) {
            angle = i * part;
            if( i==0 ) {
                ctx.strokeStyle = ColourRed;
            } else {
                ctx.strokeStyle = "black";
            }
            ctx.beginPath();
            ctx.moveTo(centerX + innerRadius   * Math.cos(angle), centerY - innerRadius   * Math.sin(angle));
            ctx.lineTo(centerX + outerRadius   * Math.cos(angle), centerY - outerRadius   * Math.sin(angle));
            ctx.stroke();
        }
    } else if( M == 2 || M == 4 /*|| M == 6*/ ) {
        const part1 = (2 * Math.PI) / (N / M);
        const part2 = (2 * Math.PI) / N / 2;
        const part3 = (2 * Math.PI) / N;
        for( i=0; i<N/M; i++ ) { // number of groups
            for( j=0; j<M/2; j++ ) { // half the spokes per group
                if( i==0 ) {
                    ctx.strokeStyle = ColourRed;
                } else {
                    ctx.strokeStyle = "black";
                }
                ctx.beginPath();
                angle = i*part1 + (j+0.5)*part3;
                ctx.moveTo(centerX + innerRadius * Math.cos(angle), centerY - innerRadius * Math.sin(angle));
                angle = i*part1 + (j+0.5)*part2;
                ctx.lineTo(centerX + outerRadius * Math.cos(angle), centerY - outerRadius * Math.sin(angle));
                angle = i*part1 + (j+0.5)*part3;
                ctx.moveTo(centerX + innerRadius * Math.cos(angle), centerY + innerRadius * Math.sin(angle));
                angle = i*part1 + (j+0.5)*part2;
                ctx.lineTo(centerX + outerRadius * Math.cos(angle), centerY + outerRadius * Math.sin(angle));
                ctx.stroke();
            }
        }
    }
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.arc(canvas.width/2, canvas.height/2, innerRadius, 0, 2 * Math.PI);
    ctx.stroke();
}

function CrossG_F( x ) {
    x.style.background = "yellow";
    HelpCrossG();
}

function HelpCrossG() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;
    var input = document.getElementById("number-of-crossings");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";
    reread();

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const outerRadius = canvas.width * 0.49;
    var innerRadiusG = (canvas.width/D) * (D1b/2);
    var innerRadiusNG = (canvas.width/D) * (D1a/2);
    ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(centerX, centerY, scaleX(4), 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.arc(centerX, centerY, innerRadiusG, 0, 2 * Math.PI);
    ctx.stroke();
    var Step = Deg2Rad( 720 / N );
    var Cbb = Math.abs(Cb);
    var shiftX, shiftY;
    switch(Cbb) {
        case 0: shiftX = -12; shiftY = -5; break;
        case 1: shiftX = -13; shiftY = -1; break;
        case 2: shiftX = -15; shiftY = 5; break;
        case 3: shiftX = -15; shiftY = 11; break;
        case 4: shiftX = -15; shiftY = 10; break;
    }
    LabelSpoke1( ctx
               , ( (Sb==0) ? "1" : "2" )
               , ( centerX + outerRadius * Math.cos(Cbb*Step) ) + shiftX
               , ( centerY - outerRadius * Math.sin(Cbb*Step) ) + shiftY
               );
    if( Cbb == 0 ) {
        ctx.beginPath();
        ctx.strokeStyle = ColourRed;
        ctx.moveTo(centerX + innerRadiusG, centerY );  // hub
        ctx.lineTo(centerX + outerRadius, centerY );  //rim
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = ColourLighterRed;
        ctx.arc(centerX + innerRadiusG , centerY, 1, 0, 2 * Math.PI);
        ctx.stroke();
    } else {
        ctx.beginPath();
        ctx.strokeStyle = ColourRed;
        ctx.moveTo(centerX + innerRadiusG * Math.cos(0), centerY - innerRadiusG * Math.sin(0)); // hub
        ctx.lineTo(centerX + outerRadius   * Math.cos(Cbb*Step), centerY - outerRadius   * Math.sin(Cbb*Step)); //rim
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = ColourLighterRed;
        ctx.arc(centerX + innerRadiusG * Math.cos(0), centerY - innerRadiusG * Math.sin(0), 1, 0, 2 * Math.PI);
        ctx.stroke();
        for( i = 0; i < Cbb; i++ ) {
	    var bgn = 2 * Step * i + Step;
	    var end = Step * ( 1 + i * 2 - Cbb );
	    ctx.beginPath();
	    ctx.strokeStyle = ColourRed;
	    ctx.moveTo(centerX + innerRadiusG * Math.cos(bgn), centerY - innerRadiusG * Math.sin(bgn)); // hub
	    ctx.lineTo(centerX + outerRadius   * Math.cos(end), centerY - outerRadius   * Math.sin(end)); // rim
	    ctx.stroke();
	    ctx.beginPath();
	    ctx.strokeStyle = ColourLighterRed;
	    ctx.arc(centerX + innerRadiusG * Math.cos(bgn), centerY - innerRadiusG * Math.sin(bgn), 1, 0, 2 * Math.PI);
	    ctx.stroke();
	    //ctx.fillText( Rad2Deg(bgn).toFixed(1), centerX-75, centerY + 12*i );
        }
        //ctx.fillText( "Step="+Rad2Deg(Step).toFixed(1), centerX-75, centerY-12   );
        //ctx.fillText( "Cb="+Cb, centerX-75, centerY-24 );
    }
    ctx.stroke();
}

function CrossNG_F( x ) {
    x.style.background = "yellow";
    HelpCrossNG();
}

function Deg2Rad( x ) {
    return x * Math.PI / 180;
}

function Rad2Deg( x ) {
    return x * 180 / Math.PI;
}

function LabelSpoke1( ctx, lbl, x, y ) {
    ctx.font = "12px 'Dejavu Sans', Verdana";
    ctx.fillStyle = "black";
    ctx.fillText(lbl, x, y);
}

function HelpCrossNG() {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;
    var input = document.getElementById("number-of-crossings-non-gear");
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";
    reread();

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const outerRadius = canvas.width * 0.49;
    var innerRadiusG = (canvas.width/D) * (D1b/2);
    var innerRadiusNG = (canvas.width/D) * (D1a/2);
    ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(centerX, centerY, scaleX(4), 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourBlue;
    ctx.arc(centerX, centerY, innerRadiusNG, 0, 2 * Math.PI);
    ctx.stroke();
    var Step = Deg2Rad( 720 / N );
    var Caa = Math.abs(Ca);
    var shiftX, shiftY;
    switch(Caa) {
        case 0: shiftX = -12; shiftY = -5; break;
        case 1: shiftX = -13; shiftY = -1; break;
        case 2: shiftX = -15; shiftY = 5; break;
        case 3: shiftX = -15; shiftY = 11; break;
        case 4: shiftX = -15; shiftY = 10; break;
    }
    LabelSpoke1( ctx
               , ( (Sb==0) ? "2" : "1" )
               , ( centerX + outerRadius * Math.cos(Caa*Step) ) + shiftX
               , ( centerY - outerRadius * Math.sin(Caa*Step) ) + shiftY
               );
    if( Math.abs(Ca) == 0 ) {
        ctx.beginPath();
        ctx.strokeStyle = ColourBlue;
        ctx.moveTo(centerX + innerRadiusNG, centerY ); // hub
        ctx.lineTo(centerX + outerRadius, centerY );   // rim
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = ColourLighterBlue;
        ctx.arc(centerX + innerRadiusNG , centerY, 1, 0, 2 * Math.PI);
        ctx.stroke();
    } else {
        ctx.beginPath();
        ctx.strokeStyle = ColourBlue;
        ctx.moveTo(centerX + innerRadiusNG * Math.cos(0), centerY - innerRadiusNG * Math.sin(0)); // hub
        ctx.lineTo(centerX + outerRadius   * Math.cos(Caa*Step), centerY - outerRadius   * Math.sin(Caa*Step)); //rim
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = ColourLighterBlue;
        ctx.arc(centerX + innerRadiusNG * Math.cos(0), centerY - innerRadiusNG * Math.sin(0), 1, 0, 2 * Math.PI);
        ctx.stroke();
        for( i = 0; i < Caa; i++ ) {
	    var bgn = 2 * Step * i + Step;
	    var end = Step * ( 1 + i * 2 - Caa );
	    ctx.beginPath();
	    ctx.strokeStyle = ColourBlue;
	    ctx.moveTo(centerX + innerRadiusNG * Math.cos(bgn), centerY - innerRadiusNG * Math.sin(bgn)); // hub
	    ctx.lineTo(centerX + outerRadius   * Math.cos(end), centerY - outerRadius   * Math.sin(end)); // rim
	    ctx.stroke();
	    ctx.beginPath();
	    ctx.strokeStyle = ColourLighterBlue;
	    ctx.arc(centerX + innerRadiusNG * Math.cos(bgn), centerY - innerRadiusNG * Math.sin(bgn), 1, 0, 2 * Math.PI);
	    ctx.stroke();
	    //ctx.fillText( Rad2Deg(bgn).toFixed(1), centerX-75, centerY + 12*i );
        }
        //ctx.fillText( "Step="+Rad2Deg(Step).toFixed(1), centerX-75, centerY-12   );
        //ctx.fillText( "Ca="+Ca, centerX-75, centerY-24 );
    }
    ctx.stroke();
}

function distance12_F(x) {
    x.style.background = "yellow";
    var input = document.getElementById("distance12");
    HelpDistance(input);
}

function distance23_F(x) {
    x.style.background = "yellow";
    var input = document.getElementById("distance23");
    HelpDistance(input);
}

function distance34_F(x) {
    x.style.background = "yellow";
    var input = document.getElementById("distance34");
    HelpDistance(input);
}

function distance45_F(x) {
    x.style.background = "yellow";
    var input = document.getElementById("distance45");
    HelpDistance(input);
}

function distance56_F(x) {
    x.style.background = "yellow";
    var input = document.getElementById("distance56");
    HelpDistance(input);
}

function HelpDistance(input) {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;
    var row = input.parentNode.parentNode;
    var top = row.getBoundingClientRect().top;
    page_offset = document.getElementById("start").getBoundingClientRect().top;
    if( page_offset < 0 ) {
        top += Math.abs(page_offset);
    }
    canvas.style.position = "absolute";
    canvas.style.top = top.toFixed(0) + "px";
    reread();

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width * 0.49, 0, Math.PI*2);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, scaleX(15), 0, 2 * Math.PI);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width * 0.460, 0, Math.PI/10);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width * 0.460, -(Math.PI/10), 0);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle = "black";
    const outerRadius = canvas.width * 0.49;
    const innerRadius = scaleX(15);
    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    ctx.moveTo(centerX + innerRadius * Math.cos(Math.PI/10), centerY - innerRadius * Math.sin(Math.PI/10));
    ctx.lineTo(centerX + outerRadius * Math.cos(Math.PI/10), centerY - outerRadius * Math.sin(Math.PI/10));
    ctx.moveTo(centerX + innerRadius * Math.cos(Math.PI/10), centerY + innerRadius * Math.sin(Math.PI/10));
    ctx.lineTo(centerX + outerRadius * Math.cos(Math.PI/10), centerY + outerRadius * Math.sin(Math.PI/10));
    ctx.stroke();
    ctx.restore();
}

function PatternF(x) {
    x.style.background = "yellow";
    Pattern();
}

function SideClick() {
    reread();
    if( validate() ) {
        display();
        Pattern();
    } else {
        clear9();
    }
}

function PatternClick() {
    reread();
    if( validate() ) {
        display();
        Pattern();
    } else {
        clear9();
    }
}

function clear9() {
    screen = 10;
    clear();
}

function clear() {
    document.getElementById("resultLineA").style.visibility = "visible";
    document.getElementById("resultLineB").style.visibility = "visible";
    document.getElementById("resultLineC").style.visibility = "visible";
    document.getElementById("resultLineD").style.visibility = "visible";
    document.getElementById("resultLineE").style.visibility = "collapse";
    document.getElementById("resultLineF").style.visibility = "collapse";
    document.getElementById("resultA").value = "";
    document.getElementById("resultB").value = "";
    document.getElementById("resultC").value = "";
    document.getElementById("resultD").value = "";
    reread();
    document.getElementById("lblResA").innerHTML = "Spoke 1 "+ (Sb==0?"gear":"non-gear") +" side:";
    document.getElementById("lblResB").innerHTML = "Spoke 2 "+ (Sb==0?"non-gear":"gear") +" side:";
    document.getElementById("lblResC").innerHTML = "Spoke 3 "+ (Sb==0?"gear":"non-gear") +" side:";
    document.getElementById("lblResD").innerHTML = "Spoke 4 "+ (Sb==0?"non-gear":"gear") +" side:";

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = HelpScreenSize;
    canvas.height = HelpScreenSize;

    ctx.lineWidth = LineWidth;
    ctx.save();
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = "black";
    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const outerRadius = canvas.width * 0.49;
    var innerRadiusG = (canvas.width/D) * (D1b/2);
    var innerRadiusNG = (canvas.width/D) * (D1a/2);
    ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(centerX, centerY, scaleX(4), 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourBlue;
    ctx.arc(centerX, centerY, innerRadiusNG, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.strokeStyle = ColourRed;
    ctx.arc(centerX, centerY, innerRadiusG, 0, 2 * Math.PI);
    ctx.stroke();
}

function Pattern() {
    reread();
    if( validate() ) {
        WriteResults();

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = "400";
        canvas.height = "400";

        var hoogte = document.getElementById("table").getBoundingClientRect().height;
        var top    = 25;

        canvas.width = ""+hoogte;
        canvas.height = ""+hoogte;
        canvas.style.position = "absolute";
        canvas.style.top = top.toFixed(0) + "px";

        ctx.lineWidth = LineWidth;
        ctx.save();
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.strokeStyle = "black";
        const centerX = canvas.width/2;
        const centerY = canvas.height/2;
        const outerRadius = canvas.width * 0.49;
        var innerRadiusG = (canvas.width/D) * (D1b/2);
        var innerRadiusNG = (canvas.width/D) * (D1a/2);
        ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(centerX, centerY, scaleX(4), 0, 2 * Math.PI);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = ColourBlue;
        ctx.arc(centerX, centerY, innerRadiusNG, 0, 2 * Math.PI);
        ctx.stroke();
        ctx.beginPath();
        ctx.strokeStyle = ColourRed;
        ctx.arc(centerX, centerY, innerRadiusG, 0, 2 * Math.PI);
        ctx.stroke();
        SetSpokeSides();
        for( i=0; i<N; i++ ) {
            ctx.beginPath();
            if( HubGearSide[i] ) { // "gear"
                ctx.strokeStyle = ColourRed;
                ctx.moveTo(centerX + innerRadiusG  * Math.cos(AngleHub[i]), centerY - innerRadiusG  * Math.sin(AngleHub[i]));
                ctx.lineTo(centerX + outerRadius   * Math.cos(AngleRim[i]), centerY - outerRadius   * Math.sin(AngleRim[i]));

            } else { // "non-gear"
                ctx.strokeStyle = ColourBlue;
                ctx.moveTo(centerX + innerRadiusNG * Math.cos(AngleHub[i]), centerY - innerRadiusNG * Math.sin(AngleHub[i]));
                ctx.lineTo(centerX + outerRadius   * Math.cos(AngleRim[i]), centerY - outerRadius   * Math.sin(AngleRim[i]));

            }
            ctx.stroke();
        }
        for( i=0; i<N; i++ ) {
            ctx.beginPath();
            ctx.strokeStyle = ColourLighterRed;
            if( HubGearSide[i] ) { // "gear"
                ctx.arc(centerX + innerRadiusG  * Math.cos(AngleHub[i]), centerY - innerRadiusG  * Math.sin(AngleHub[i]), 1, 0, 2 * Math.PI);
            }
            ctx.stroke();
        }
        for( i=0; i<N; i++ ) {
            ctx.beginPath();
            ctx.strokeStyle = ColourLighterBlue;
            if( ! HubGearSide[i] ) { // "non gear"
                ctx.arc(centerX + innerRadiusNG * Math.cos(AngleHub[i]), centerY - innerRadiusNG * Math.sin(AngleHub[i]), 1, 0, 2 * Math.PI);
            }
            ctx.stroke();
        }
        ctx.font = "18px 'Dejavu Sans', Verdana";
        ctx.fillStyle = "black";
        for( i=0; i<4; i++ ) {
            ctx.fillText(i+1, (centerX + outerRadius * Math.cos(AngleRim[i]))-(15+i*3), (centerY - outerRadius * Math.sin(AngleRim[i]))-6);
        }
        ctx.restore();
    }
}

</script>

